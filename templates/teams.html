<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Teams - HUNTING-CTF</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='theme.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='theme.js') }}"></script>
  </head>
  <body>
    <!-- Theme Toggle -->
    <div class="theme-toggle-container" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
      <button class="theme-toggle" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>
    </div>

    <link rel="stylesheet" href="{{ url_for('static', filename='teams.css') }}">
    <div class="teams-wrapper">
      <div class="teams-hero">
        <h1><i class="fas fa-users"></i> Teams</h1>
        <p>Create or join a team to collaborate and climb the leaderboard together.</p>
        <div class="teams-actions">
          <a class="btn" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
          <a class="btn" href="{{ url_for('team_scoreboard') }}"><i class="fas fa-trophy"></i> Team Leaderboard</a>
        </div>
      </div>

      <div class="teams-grid">
        <div class="panel">
          <h3><i class="fas fa-plus-circle"></i> Create Team</h3>
          {% if not my_membership %}
          <form method="POST">
            <input type="text" name="name" placeholder="Team name" required />
            <button type="submit" class="btn"><i class="fas fa-plus"></i> Create & Join</button>
          </form>
          {% else %}
          <p class="muted">You are already in a team.</p>
          {% endif %}

          <div class="divider"></div>

          <h3><i class="fas fa-key"></i> Join by Team Code</h3>
          {% if not my_membership %}
          <form method="POST" action="{{ url_for('join_team_by_code') }}">
            <input type="text" name="team_code" placeholder="Enter team code (e.g., ABC123)" required style="text-transform: uppercase;" maxlength="6" />
            <button type="submit" class="btn" style="background: var(--accent-info);"><i class="fas fa-sign-in-alt"></i> Join Team</button>
          </form>
          {% else %}
          <p class="muted">You are already in a team.</p>
          {% endif %}
          <div class="notice">Tip: Team codes are 6 characters, letters and numbers.</div>
        </div>

        <div class="panel">
          <h3><i class="fas fa-list"></i> All Teams</h3>
          {% if teams %}
          <div class="team-list">
            {% for team in teams %}
            <div class="team-card">
              <div class="team-card__header">
                <div>
                  <h4 class="team-card__title">{{ team.name }}</h4>
                  <div class="badge-code">Code: {{ team.team_code }}</div>
                </div>
                <div class="team-card__actions">
                  {% if not my_membership or my_membership.team_id != team.id %}
                  <form method="POST" action="{{ url_for('join_team') }}">
                    <input type="hidden" name="team_id" value="{{ team.id }}" />
                    <button type="submit" class="btn" style="background: var(--accent-success);"><i class="fas fa-plus"></i> Join</button>
                  </form>
                  {% else %}
                  <form method="POST" action="{{ url_for('leave_team') }}">
                    <button type="submit" class="btn" style="background: var(--accent-danger);"><i class="fas fa-sign-out-alt"></i> Leave</button>
                  </form>
                  {% endif %}
                </div>
              </div>
              {% if team_members[team.id] %}
              <div class="team-card__members">
                <div class="team-card__meta">
                  <span class="meta-chip"><i class="fas fa-user"></i> {{ team_members[team.id]|length }} member{{ 's' if team_members[team.id]|length != 1 else '' }}</span>
                </div>
                <ul>
                  {% for member in team_members[team.id] %}
                  <li>
                    {{ member.username }} ({{ member.score }} pts)
                    {% if my_team and my_team.id == team.id %}
                      <span style="color: var(--accent-success);">{% if loop.first %}ðŸ‘‘{% endif %}</span>
                    {% endif %}
                  </li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% else %}
          <p class="muted">No teams yet. Be the first to create one!</p>
          {% endif %}
        </div>
      </div>

      {% if my_team %}
      <div class="panel" style="margin-top: 18px; border-color: var(--accent-success);">
        <h3 style="color: var(--accent-success); margin-top: 0;"><i class="fas fa-crown"></i> Your Team: {{ my_team.name }}</h3>
        <p class="muted" style="margin-bottom: 12px;">Collaborate with your teammates to solve challenges and climb the leaderboard!</p>
        <a href="{{ url_for('team_scoreboard') }}" class="btn" style="background: var(--accent-primary); color: var(--button-text);"><i class="fas fa-trophy"></i> View Team Leaderboard</a>
      </div>
      {% endif %}
    </div>
    {% include '_contact_footer.html' %}
  </body>
</html>

