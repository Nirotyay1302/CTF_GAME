{% extends "base.html" %}

{% block title %}Team Rankings - HUNTING-CTF{% endblock %}

{% block extra_css %}
<style>
    .team-scoreboard-header {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 15px;
        position: relative;
        overflow: hidden;
    }

    .team-scoreboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>');
        animation: float 20s ease-in-out infinite;
    }

    .team-scoreboard-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
    }

    .team-scoreboard-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }

    .team-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .team-stat-card {
        background: var(--bg-card);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .team-stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .team-stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--accent-primary);
        margin-bottom: 0.5rem;
        line-height: 1;
    }

    .team-stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .team-table {
        background: var(--bg-card);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        border: 1px solid var(--border-color);
        margin-bottom: 2rem;
    }

    .team-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .team-table th {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        padding: 1.25rem 1rem;
        font-weight: 700;
        text-align: left;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
    }

    .team-table th::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, rgba(255,255,255,0.3), transparent);
    }

    .team-table td {
        padding: 1.5rem 1rem;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-primary);
        vertical-align: middle;
    }

    .team-table tr {
        transition: all 0.3s ease;
        position: relative;
    }

    .team-table tr:hover {
        background: linear-gradient(90deg, var(--bg-secondary), var(--bg-tertiary));
        transform: scale(1.01);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .team-table tr:last-child td {
        border-bottom: none;
    }

    .team-table tr.top-team {
        background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), transparent);
        border-left: 4px solid #ffd700;
    }

    .team-table tr.top-team:hover {
        background: linear-gradient(90deg, rgba(255, 215, 0, 0.2), var(--bg-secondary));
    }

    .team-rank {
        font-weight: 800;
        font-size: 1.5rem;
        text-align: center;
        width: 80px;
        position: relative;
    }

    .team-rank.gold {
        color: #ffd700;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        animation: goldGlow 2s ease-in-out infinite alternate;
    }
    .team-rank.silver {
        color: #c0c0c0;
        text-shadow: 0 0 8px rgba(192, 192, 192, 0.5);
    }
    .team-rank.bronze {
        color: #cd7f32;
        text-shadow: 0 0 8px rgba(205, 127, 50, 0.5);
    }

    @keyframes goldGlow {
        0% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.3); }
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }

    .team-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .team-avatar {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.2rem;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        flex-shrink: 0;
    }

    .team-details {
        flex: 1;
        min-width: 0;
    }

    .team-name {
        font-weight: 700;
        font-size: 1.2rem;
        color: var(--accent-primary);
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .team-badge {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        padding: 0.2rem 0.6rem;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .team-members {
        font-size: 0.9rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .member-tag {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        padding: 0.2rem 0.6rem;
        border-radius: 8px;
        font-size: 0.8rem;
        border: 1px solid var(--border-color);
    }

    .team-score {
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--accent-success);
        text-align: center;
    }

    .team-solves {
        text-align: center;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .team-size {
        text-align: center;
        font-weight: 500;
    }

    .team-medal {
        text-align: center;
        font-size: 1.5rem;
    }

    .navigation-buttons {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .nav-btn {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        color: white;
        text-decoration: none;
    }

    .recent-activity {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        margin-top: 2rem;
    }

    .activity-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-content {
        flex: 1;
    }

    .activity-team {
        font-weight: 600;
        color: var(--accent-primary);
    }

    .activity-user {
        font-weight: 600;
        color: var(--text-primary);
    }

    .activity-challenge {
        color: var(--accent-secondary);
        font-weight: 500;
    }

    .activity-points {
        color: var(--accent-success);
        font-weight: 600;
    }

    .activity-time {
        color: var(--text-muted);
        font-size: 0.85rem;
        white-space: nowrap;
        margin-left: 1rem;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--text-muted);
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    @media (max-width: 768px) {
        .team-scoreboard-header h1 {
            font-size: 2rem;
        }

        .team-stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .team-stat-card {
            padding: 1rem;
        }

        .team-stat-number {
            font-size: 2rem;
        }

        .team-table th,
        .team-table td {
            padding: 0.75rem 0.5rem;
            font-size: 0.9rem;
        }

        .navigation-buttons {
            flex-direction: column;
        }

        .nav-btn {
            justify-content: center;
        }

        .activity-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .activity-time {
            margin-left: 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Team Scoreboard Header -->
<div class="team-scoreboard-header text-center">
    <div class="container">
        <h1><i class="fas fa-users"></i> Team Rankings</h1>
        <p>Collaborative competition leaderboard</p>
    </div>
</div>

<!-- Navigation -->
<div class="navigation-buttons">
    <a href="{{ url_for('scoreboard') }}" class="nav-btn">
        <i class="fas fa-user"></i> Individual Rankings
    </a>
    <a href="{{ url_for('teams') }}" class="nav-btn">
        <i class="fas fa-cog"></i> Manage Teams
    </a>
    <a href="{{ url_for('dashboard') }}" class="nav-btn">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>

<!-- Team Statistics -->
<div class="team-stats-grid">
    <div class="team-stat-card">
        <div class="team-stat-number">{{ total_teams }}</div>
        <div class="team-stat-label">Active Teams</div>
    </div>
    <div class="team-stat-card">
        <div class="team-stat-number">{{ total_team_members }}</div>
        <div class="team-stat-label">Team Members</div>
    </div>
    <div class="team-stat-card">
        <div class="team-stat-number">{{ avg_team_score|round(1) }}</div>
        <div class="team-stat-label">Average Score</div>
    </div>
    <div class="team-stat-card">
        <div class="team-stat-number">{{ avg_team_size|round(1) }}</div>
        <div class="team-stat-label">Average Size</div>
    </div>
</div>

<!-- Team Rankings Table -->
<div class="team-table">
    <table>
        <thead>
            <tr>
                <th style="text-align: center;">Rank</th>
                <th>Team Name</th>
                <th style="text-align: center;">Members</th>
                <th style="text-align: center;">Solves</th>
                <th style="text-align: center;">Score</th>
                <th style="text-align: center;">Medal</th>
            </tr>
        </thead>
        <tbody>
            {% for team in teams %}
            <tr {% if team.rank <= 3 %}class="top-team"{% endif %}>
                <td class="team-rank {% if team.rank == 1 %}gold{% elif team.rank == 2 %}silver{% elif team.rank == 3 %}bronze{% endif %}">
                    {{ team.rank }}
                </td>
                <td>
                    <div class="team-info">
                        <div class="team-avatar">
                            {{ team.name[0].upper() }}
                        </div>
                        <div class="team-details">
                            <div class="team-name">
                                {{ team.name }}
                                {% if team.rank <= 3 %}
                                    <span class="team-badge">Top {{ team.rank }}</span>
                                {% endif %}
                            </div>
                            <div class="team-members">
                                {% for member in team.members[:4] %}
                                    <span class="member-tag">{{ member.username }}</span>
                                {% endfor %}
                                {% if team.members|length > 4 %}
                                    <span class="member-tag">+{{ team.members|length - 4 }} more</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </td>
                <td class="team-size">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-users" style="color: var(--accent-primary);"></i>
                        <strong>{{ team.member_count }}</strong>
                    </div>
                </td>
                <td class="team-solves">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-trophy" style="color: var(--accent-success);"></i>
                        <strong>{{ team.solve_count }}</strong>
                    </div>
                </td>
                <td class="team-score">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-star" style="color: var(--accent-warning);"></i>
                        <strong style="font-size: 1.1rem;">{{ team.score }}</strong>
                    </div>
                </td>
                <td class="team-medal">
                    {% if team.rank == 1 %}
                        <div style="font-size: 2rem; animation: bounce 2s infinite;">🥇</div>
                    {% elif team.rank == 2 %}
                        <div style="font-size: 2rem;">🥈</div>
                    {% elif team.rank == 3 %}
                        <div style="font-size: 2rem;">🥉</div>
                    {% else %}
                        <div style="color: var(--text-muted); font-size: 1.2rem;">
                            <i class="fas fa-medal"></i>
                        </div>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h5>No Teams Found</h5>
                    <p>Teams will appear here when they are created and start solving challenges.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Recent Team Activity -->
{% if recent_team_solves %}
<div class="recent-activity">
    <h4 class="mb-3">
        <i class="fas fa-clock"></i> Recent Team Activity
    </h4>
    {% for solve in recent_team_solves %}
    <div class="activity-item">
        <div class="activity-content">
            <span class="activity-team">{{ solve.team_name }}</span> member
            <span class="activity-user">{{ solve.username }}</span>
            solved
            <span class="activity-challenge">{{ solve.title }}</span>
            <span class="activity-points">({{ solve.points }} pts)</span>
        </div>
        <div class="activity-time">
            {{ solve.timestamp.strftime('%H:%M') }}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}